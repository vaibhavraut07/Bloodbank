<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <style>
        .nav-pills .nav-link.active,
        .nav-pills .show > .nav-link {
            color: white !important;
            background-color: #dc3545 !important;
        }
        .nav-link {
            color: #dc3545 !important;
        }
    </style>
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
        crossorigin="anonymous"
    >
</head>
<body>
<div class="container my-4">
    <nav class="nav nav-pills flex-column flex-sm-row border-danger border rounded-3">
        <a class="flex-sm-fill text-sm-center nav-link active fw-bold" aria-current="page" href="/bloodbanks/op">BLOOD BANK</a>
        <a class="flex-sm-fill text-sm-center nav-link fw-bold" href="/Donors/check">BLOOD DONOR</a>
    </nav>
</div>
<div class="modal position-static d-block" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-danger"><b>Blood Bank Data</b></h5>
            </div>
            <div class="modal-body">
                <form>
                    <!-- District Select Menu -->
                    <select class="form-select mb-4" id="districtSelect" aria-label="Default select example">
                        <option selected>Select District</option>
                        <% for (const op of bloodBanks) { %>
                            <option value="<%= op.district %>"><%= op.district %></option>
                        <% } %>
                    </select>

                    <!-- City Select Menu -->
                    <select class="form-select mb-3" id="citySelect" aria-label="Default select example">
                        <option selected>Select City</option>
                        <% for (const op of bloodBanks) { %>
                            <option value="<%= op.city %>"><%= op.city %></option>
                        <% } %>
                    </select>

                    <!-- Pincode TextField -->
                    <div class="mb-3">
                        <label for="exampleInputPincode" class="form-label"><b>Pincode</b></label>
                        <input type="number" class="form-control" id="exampleInputPincode" aria-describedby="emailHelp">
                    </div>

                    <button type="submit" class="btn btn-danger" onclick="filterBloodBanks()">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Table Content -->
<div class="container">
    <table class="table table-bordered border-danger">
        <thead>
            <tr>
                <th scope="col" class="text-white bg-danger">Sr no.</th>
                <th scope="col" class="text-white bg-danger">Blood Bank Name</th>
                <th scope="col" class="text-white bg-danger">Phone no.</th>
                <th scope="col" class="text-white bg-danger">More Detail</th>
            </tr>
        </thead>
        <tbody id="bloodBankTableBody">
            <!-- Blood bank data will be dynamically populated here -->
            <% let serialNumber = 1; %>
            <% for (const op of bloodBanks) { %>
                <tr>
                    <th scope="row"><%= serialNumber %></th>
                    <td><%=op.name%></td> 
                    <td><%= op.phone %></td>
                    <td>
                        <a
                            href="#"
                            data-bs-toggle="modal"
                            data-bs-target="#exampleModal<%= op._id %>"
                            onclick="fetchMoreDetails('<%= op._id %>')"
                        >
                            click for more info
                        </a>
                    </td>
                </tr>
                <% serialNumber++; %>
            <% } %>
        </tbody>
    </table>
</div>

<!-- Modal for More Details -->
<% for (const bloodBank of bloodBanks) { %>
    <div class="modal fade" id="exampleModal<%= bloodBank._id %>" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">More Details</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="moreDetails<%= bloodBank._id %>">
                    <!-- More details content will be rendered here using JavaScript -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
<% } %>

<script>
  // Function to filter and render blood bank data based on district and city selections
  function filterBloodBanks() {
    // Get selected district and city
    const selectedDistrict = document.getElementById('districtSelect').value;
    const selectedCity = document.getElementById('citySelect').value;

    // Filter the blood bank data based on selections
    const filteredBloodBanks = bloodBanks.filter(bloodBank => {
      return (
        (selectedDistrict === 'Select District' || bloodBank.district === selectedDistrict) &&
        (selectedCity === 'Select City' || bloodBank.city === selectedCity)
      );
    });

    // Clear the table body
    const tableBody = document.getElementById('bloodBankTableBody');
    tableBody.innerHTML = '';

    // Render filtered blood bank data in the table
    filteredBloodBanks.forEach((bloodBank, index) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <th scope="row">${index + 1}</th>
        <td>${bloodBank.blood_bank_name}</td>
        <td>${bloodBank.contact_no}</td>
        <td>
          <a href="#"
             data-bs-toggle="modal"
             data-bs-target="#exampleModal${bloodBank._id}"
             onclick="fetchMoreDetails('${bloodBank._id}')">
            click for more info
          </a>
        </td>
      `;
      tableBody.appendChild(row);
    });
  }
</script>

</body>
</html>
